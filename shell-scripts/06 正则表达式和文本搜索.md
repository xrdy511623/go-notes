
---
正则表达式与文本搜索
---

# 1 grep 
# 1.1 元字符
. 匹配除换行符外的任意单个字符

```shell
grep customdockerspa.... -in jupyterhub_config.py
```

匹配文本jupyterhub_config.py中含有customdockerspa(后面跟着任意四个字符)的内容，忽略大小写并显示行号。

*  匹配前一个字符出现0次或无限次，即可有可无。

```shell
grep customdocker.* -in jupyterhub_config.py
```
.和*符合结合使用实现通配符效果


[] 匹配[]中列举的字符

```shell
grep [Hh]ello test.txt
```

^ 匹配开头
```shell
grep ^c jupyterhub_config.py -in
```

$ 匹配结尾
```shell
grep true$ jupyterhub_config.py -in 
```

\ 转义后面的特殊字符
```shell
grep "\." -i jupyterhub_config.py 
```

## 1.2 扩展元字符
+ 匹配前面的正则表达式至少出现一次
？匹配前面的正则表达式出现零次或一次 
| 匹配它前面或后面的正则表达式

## 1.3 grep 选项

> -v  不显示匹配行信息
> -i  搜索匹配时忽略大小写
> -n  显示行号
> -r  递归搜索
> E   支持扩展正则表达式
> F   不按正则表达式匹配，按照字符串字面意思匹配
> c  只显示匹配行总数，不显示具体内容
> w  匹配整词
> x 匹配整行
> l 只显示文件名，不显示内容
> s 不显示错误信息

## 1.4 grep和egrep的区别
grep默认不支持扩展的正则表达式，只支持基础的正则表达式；
但是使用grep -E可以支持扩展正则表达式。
egrep支持扩展的正则表达式，与grep -E等价。

```shell
grep -E 'python|PYTHON' file
egrep 'python|PYTHON' file 
```

# 2 sed

## 2.1 sed的选项
sed 一般用于对文本内容进行替换

> -n 只打印模式匹配行
> -e 直接在命令行进行sed编辑，默认选项
> -f 编辑动作保存在文件中，指定文件执行
> -r 支持扩展正则表达式
> -i 直接修改文件内容

```shell
sed '/python/p' sed.txt
```
打印匹配python的行(p意为print)，但是默认会打印所有行，要达到预期效果，需要加上-n选项

```shell
sed -n -r '/python|PYTHON/p' sed.txt
```

```shell
echo /python/p > edit.sed
```

使用 edit.sed 中定义的 sed 编辑脚本来处理 sed.txt 文件，并根据编辑脚本的规则对文本进行修改或过滤，
但只打印模式匹配行。
```shell
sed -n -f edit.sed sed.txt
```





![sed-demo.png](images%2Fsed-demo.png)





```shell
sed -i 's/love/like/g' sed.txt
cat sed.txt
# ouput
I like python
I like PYTHON
```

## 2.2 pattern用法表

> 10command  匹配到第10行
> 10,20command 匹配从第10行开始，到第20行结束
> 10，+5command 匹配从第10行开始，到第16行结束
> /pattern1/command  匹配到pattern1的行
> /pattern1/,/pattern2/command  从匹配到pattern1的行开始，到匹配到pattern2的行结束
> 10,/pattern1/command  匹配从第10行开始，到匹配到pattern1的行结束
> /pattern1/,10command 匹配从匹配到pattern1的行开始，到第10行结束

sed是流编辑器，依据特定的匹配模式，对文本逐行匹配，并对匹配行进行特定处理
命令格式:
```shell
sed [option] "/pattern/command" file
```

**pattern用法示例**
> 指定行号

```shell
# 打印文件file的第17行
sed -n '17p' file 
```

> 指定起始和结束行号

```shell
# 打印文件file的第10行到第20行
sed -n '10,20p' file 
```

> 指定起始行和偏移量

```shell
# 打印文件file从第10行开始，往后面加5行的所有行
sed -n '10,+5p' file 
```

> 指定正则表达式匹配

```shell
# 打印文件file中以root开头的行
sed -n '/^root/p' file 
```

> 指定两个匹配模式分别作为起始行和结束行

```shell
# 从文件file中以root开始的行开始打印，到以sbin结尾的行结束
sed -n '/^root/,/sbin$/p'
```

> 从指定行号开始，到匹配模式所在行结束

```shell
# 从文件file中第4行开始，到匹配到以hdfs开头的行结束
sed -n '4,/^hdfs/p' file
```
> 从匹配模式所在行开始，到指定行号结束

```shell
# 从匹配到以root结尾的行开始，到文件file中第10行结束。
sed -n '/root$/,10p' file
```

**编辑命令**

> p 打印
> a 行后追加
> i 行前追加(表示在原始文件上直接进行编辑)
> r 外部文件读入，行后追加
> w 匹配行写入外部文件
> d 删除
> s/old/new  将行内第一个old替换为new
> s/old/new/g  将行内全部old替换为new
> s/old/new/2g  将行内前两个old替换为new
> s/old/new/ig  将行内全部old替换为new,并且忽略大小写


**编辑使用示例**

> 删除passwd文件的第一行，如果不使用-i选项，则意味着删除文件passwd中第一行的内容，并将结果输出到标准输出
但是passwd文件的原始内容不会被修改
```shell
sed -i '1d' passwd
```

> 删除passwd文件的第一行到第三行
```shell
sed -i '1,3d' passwd
```

> 将passwd文件中包含/var/empty的行删除
```shell
sed -i '/\/var\/empty/d' passwd
```

> 将模式匹配起始行到结束行删除
```shell
sed -i '/^mail/,/^ftp/d' passwd
```

> 将passwd文件中包含/bin/bash的行后追加This is a special user
```shell
sed -i '/\/bin\/bash/a This is a special user' passwd
```

> 在passwd文件中以daemon开头的行前插入insert some data before the given line
```shell
sed -i '/^daemon/i insert some data before the given line' passwd
```

> 从文件source.txt中读取数据，追加写入到passwd文件中以root开头的行后边
```shell
sed -i '/^root/r source.txt' passwd
```

> 匹配行写入外部文件, 将文件passwd中含有/usr/bin的行读取出来写入到外部文件temp.txt中
```shell
sed -n '/\/usr\/bin/w temp.txt' passwd
```

> 全局修改, 将文件passwd中含有/bin/bash的行中这部分改为/BIN/BASH
```shell
sed -i 's/\/bin\/bash/\/BIN\/BASH/g' passwd
```